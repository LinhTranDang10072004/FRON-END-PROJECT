<div class="wallet-deposit-page">
  <div class="account-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <a routerLink="/account" routerLinkActive="active" class="nav-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
          <span>Thông tin tài khoản</span>
        </a>
        <a routerLink="/account/wallet" routerLinkActive="active" class="nav-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
            <line x1="1" y1="10" x2="23" y2="10"/>
          </svg>
          <span>Ví của tôi</span>
        </a>
        <a routerLink="/account/vat" class="nav-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <span>Thông tin xuất hóa đơn VAT</span>
        </a>
        <a routerLink="/account/orders" class="nav-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"/>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
          </svg>
          <span>Đơn hàng đã mua</span>
        </a>
        <a routerLink="/account/activity" class="nav-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
          </svg>
          <span>Nhật ký hoạt động</span>
        </a>
        <button class="nav-item logout-item" (click)="authService.logout()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          <span>Đăng xuất</span>
        </button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Transfer Information Section -->
      <div class="transfer-info-section">
        <h2 class="section-title">Thông tin chuyển khoản</h2>
        
        <div class="transfer-content">
          <!-- QR Code -->
          <div class="qr-code-container">
            <div class="qr-code-wrapper">
              @if (isLoadingQr()) {
                <div class="qr-code-loading">
                  <div class="loading-spinner"></div>
                  <p>Đang tải QR code...</p>
                </div>
              } @else if (qrError()) {
                <div class="qr-code-error">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                  <p>{{ qrError() }}</p>
                  <button class="btn-retry" (click)="loadDepositQr()">Thử lại</button>
                </div>
              } @else if (qrData() && qrCodeBase64()) {
                <div class="qr-code-display">
                  <div class="qr-code-text">VIETQR</div>
                  <div class="qr-code-image">
                    <img [src]="qrCodeBase64()!" alt="QR Code nạp tiền" />
                  </div>
                  <div class="qr-code-text">napas247</div>
                </div>
              }
            </div>
          </div>

          <!-- Transfer Details -->
          @if (getAdminAccount()) {
            <div class="transfer-details">
              <div class="transfer-detail-item">
                <span class="detail-label">Ngân hàng thụ hưởng</span>
                <div class="detail-value-with-logo">
                  @if (getBankLogo(getAdminAccount()!.bankName)) {
                    <img [src]="getBankLogo(getAdminAccount()!.bankName)" [alt]="getAdminAccount()!.bankName" class="bank-logo-small" />
                  }
                  <span>{{ getAdminAccount()!.bankName }}</span>
                </div>
              </div>

              <div class="transfer-detail-item">
                <span class="detail-label">Số tài khoản</span>
                <div class="detail-value-with-action">
                  <span class="detail-value">{{ getAdminAccount()!.accountNumber }}</span>
                  <button class="btn-copy" (click)="copyToClipboard(getAdminAccount()!.accountNumber)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                    </svg>
                    Copy
                  </button>
                </div>
              </div>

              <div class="transfer-detail-item">
                <span class="detail-label">Nội dung CK</span>
                <div class="detail-value-with-action">
                  <span class="detail-value highlight">{{ getAdminAccount()!.transferContent }}</span>
                  <button class="btn-copy" (click)="copyToClipboard(getAdminAccount()!.transferContent)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                    </svg>
                    Copy
                  </button>
                </div>
                <div class="detail-note">
                  <strong>QUAN TRỌNG:</strong> Bạn phải nhập đúng nội dung này khi chuyển khoản
                </div>
              </div>

              <div class="transfer-detail-item">
                <span class="detail-label">Chủ tài khoản</span>
                <span class="detail-value">{{ getAdminAccount()!.accountName }}</span>
              </div>
            </div>
          }
        </div>

        <!-- Important Note -->
        <div class="important-note">
          <p><strong>Lưu ý quan trọng:</strong></p>
          <ul>
            <li>Vui lòng chuyển <strong>ĐÚNG NỘI DUNG</strong> chuyển khoản (mã cố định của bạn) khi thực hiện giao dịch</li>
            <li>Bạn tự nhập số tiền muốn nạp khi chuyển khoản</li>
            <li>Chuyển nhanh Napas 24/7 để đơn hàng được ghi nhận nhanh chóng</li>
            <li>Senpay sẽ tự động kiểm tra trùng mã giao dịch</li>
          </ul>
        </div>

        <div class="minimum-deposit">
          <span>Nạp tối thiểu: 2.000₫</span>
        </div>
      </div>

      <!-- Deposit History Section -->
      <div class="deposit-history-section">
        <h2 class="section-title">Lịch sử nạp tiền</h2>

        <!-- Search and Filter -->
        <div class="filters-bar">
          <div class="search-box">
            <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <input 
              type="text" 
              class="search-input"
              placeholder="Tìm kiếm mã giao dịch, nội dung chuyển khoản"
              [value]="searchQuery()"
              (input)="searchQuery.set($any($event.target).value)"
              (keydown.enter)="onSearch()"
            />
          </div>

          <div class="time-filter">
            <input 
              type="date"
              class="date-input"
              [value]="timeFilter()"
              (change)="timeFilter.set($any($event.target).value); onTimeFilterChange()"
            />
          </div>
        </div>

        <!-- Deposit History Table -->
        @if (isLoading()) {
          <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Đang tải...</p>
          </div>
        } @else if (deposits().length === 0) {
          <div class="empty-state">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <p>Chưa có giao dịch nạp tiền nào</p>
          </div>
        } @else {
          <div class="table-container">
            <table class="deposit-table">
              <thead>
                <tr>
                  <th>Thời gian</th>
                  <th>Ngân hàng</th>
                  <th>Nội dung chuyển khoản</th>
                  <th>Số tiền nạp</th>
                  <th>Trạng thái</th>
                </tr>
              </thead>
              <tbody>
                @for (deposit of deposits(); track deposit.id) {
                  <tr>
                    <td class="time-cell">{{ formatDateTime(deposit.createdAt) }}</td>
                    <td>
                      @if (deposit.adminBankName) {
                        @if (getBankLogo(deposit.adminBankName)) {
                          <img [src]="getBankLogo(deposit.adminBankName)" [alt]="deposit.adminBankName" class="bank-logo-table" />
                        } @else {
                          <span>{{ deposit.adminBankName }}</span>
                        }
                      } @else {
                        <span>-</span>
                      }
                    </td>
                    <td>{{ deposit.description || '-' }}</td>
                    <td class="amount-cell">{{ formatPrice(deposit.amount) }}₫</td>
                    <td>
                      <span class="status-badge" [class]="getStatusClass(deposit.status)">
                        {{ getStatusLabel(deposit.status) }}
                      </span>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div class="pagination-container">
            <div class="pagination-info">
              <span>Hiển thị {{ deposits().length }} của {{ totalCount() }} hàng</span>
              <select 
                class="page-size-select"
                [value]="pageSize()"
                (change)="onPageSizeChange(parsePageSize($any($event.target).value))"
              >
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
              <span>Mỗi trang</span>
            </div>
            <div class="pagination-controls">
              <button 
                class="pagination-btn"
                (click)="onPageChange(1)"
                [disabled]="currentPage() === 1"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="11 17 6 12 11 7"/>
                  <polyline points="18 17 13 12 18 7"/>
                </svg>
              </button>
              <button 
                class="pagination-btn"
                (click)="onPageChange(currentPage() - 1)"
                [disabled]="currentPage() === 1"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="15 18 9 12 15 6"/>
                </svg>
              </button>
              @for (page of getPageNumbers(); track page) {
                @if (page === -1) {
                  <span class="pagination-ellipsis">...</span>
                } @else {
                  <button 
                    class="pagination-btn"
                    [class.active]="currentPage() === page"
                    (click)="onPageChange(page)"
                  >
                    {{ page }}
                  </button>
                }
              }
              <button 
                class="pagination-btn"
                (click)="onPageChange(currentPage() + 1)"
                [disabled]="currentPage() === totalPages()"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"/>
                </svg>
              </button>
              <button 
                class="pagination-btn"
                (click)="onPageChange(totalPages())"
                [disabled]="currentPage() === totalPages()"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="13 17 18 12 13 7"/>
                  <polyline points="6 17 11 12 6 7"/>
                </svg>
              </button>
            </div>
          </div>
        }
      </div>
    </main>
  </div>
</div>

