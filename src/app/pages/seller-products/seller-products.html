<div class="seller-products-container">
  @if (isLoadingProducts() && products().length === 0) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Đang tải sản phẩm...</p>
    </div>
  } @else if (errorMessage()) {
    <div class="error-container">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
        <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <h2>Lỗi</h2>
      <p>{{ errorMessage() }}</p>
      <a routerLink="/" class="btn-back">Về trang chủ</a>
    </div>
  } @else {
    <!-- Seller Header -->
    @if (sellerInfo()) {
      <div class="seller-header">
        <div class="seller-avatar">
          @if (sellerInfo()?.shopAvatar) {
            <img [src]="sellerInfo()!.shopAvatar" [alt]="sellerInfo()!.shopName || sellerInfo()!.username" />
          } @else {
            <div class="avatar-placeholder">
              {{ (sellerInfo()!.shopName || sellerInfo()!.username).charAt(0).toUpperCase() }}
            </div>
          }
        </div>
        <div class="seller-info">
          <h1 class="seller-name">
            {{ sellerInfo()!.shopName || sellerInfo()!.username }}
            @if (sellerInfo()!.isVerified) {
              <span class="verified-badge" title="Đã xác thực">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                </svg>
              </span>
            }
          </h1>
          @if (sellerInfo()!.shopDescription) {
            <p class="seller-description">{{ sellerInfo()!.shopDescription }}</p>
          }
          <div class="seller-stats">
            <div class="stat-item">
              <span class="stat-label">Đánh giá:</span>
              <span class="stat-value">{{ formatRating(sellerInfo()!.rating) }}</span>
              <span class="stat-count">({{ sellerInfo()!.totalRatings }} đánh giá)</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Đã bán:</span>
              <span class="stat-value">{{ formatSales(sellerInfo()!.totalSales) }}</span>
            </div>
            @if (sellerInfo()!.telegram) {
              <div class="stat-item">
                <span class="stat-label">Telegram:</span>
                <a [href]="'https://t.me/' + sellerInfo()!.telegram?.replace('@', '')" target="_blank" class="telegram-link">
                  {{ sellerInfo()!.telegram }}
                </a>
              </div>
            }
          </div>
        </div>
      </div>
    }

    <!-- Sort and Filter -->
    <div class="products-controls">
      <div class="sort-controls">
        <label for="sortBy">Sắp xếp:</label>
        <select id="sortBy" [value]="sortBy()" (change)="onSortChange($any($event.target).value)">
          <option value="newest">Mới nhất</option>
          <option value="popular">Phổ biến nhất</option>
          <option value="bestseller">Bán chạy nhất</option>
          <option value="price_asc">Giá: Tăng dần</option>
          <option value="price_desc">Giá: Giảm dần</option>
          <option value="rating">Đánh giá cao nhất</option>
        </select>
      </div>
      <div class="products-count">
        Tìm thấy {{ products().length }} sản phẩm
      </div>
    </div>

    <!-- Products Grid -->
    @if (products().length === 0 && !isLoadingProducts()) {
      <div class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
          <path d="M9 9H15M9 15H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <h2>Chưa có sản phẩm</h2>
        <p>Người bán này chưa có sản phẩm nào.</p>
      </div>
    } @else {
      <div class="products-grid">
        @for (product of products(); track product.id) {
          <div class="product-card">
            <div class="product-image">
              @if (getProductImages(product).length > 0) {
                <img [src]="getProductImages(product)[0]" [alt]="product.name" />
              } @else {
                <div class="image-placeholder">
                  <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/>
                    <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              }
              @if (product.isFeatured) {
                <span class="featured-badge">Nổi bật</span>
              }
            </div>
            <div class="product-content">
              <h3 class="product-title">{{ product.name }}</h3>
              @if (product.description) {
                <p class="product-description">{{ product.description }}</p>
              }
              <div class="product-price">
                {{ formatPriceRange(product) }}
              </div>
              <div class="product-stats">
                <div class="product-stat">
                  @if (getProductRating(product) > 0) {
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                    </svg>
                    <span>{{ formatRating(getProductRating(product)) }}</span>
                    <span class="stat-count">({{ product.totalRatings }})</span>
                  } @else {
                    <span>Chưa có đánh giá</span>
                  }
                </div>
                <div class="product-stat">
                  <span>Đã bán: {{ formatSales(product.totalSales) }}</span>
                </div>
              </div>
              <button class="btn-view-product" [routerLink]="['/san-pham', product.productCode]">
                Xem chi tiết
              </button>
            </div>
          </div>
        }
      </div>

      <!-- Pagination -->
      @if (totalPages() > 1) {
        <div class="pagination">
          <button 
            class="pagination-btn" 
            [disabled]="currentPage() === 1"
            (click)="onPageChange(currentPage() - 1)"
          >
            Trước
          </button>
          @for (page of [].constructor(totalPages()); track $index) {
            <button 
              class="pagination-btn"
              [class.active]="currentPage() === $index + 1"
              (click)="onPageChange($index + 1)"
            >
              {{ $index + 1 }}
            </button>
          }
          <button 
            class="pagination-btn" 
            [disabled]="currentPage() === totalPages()"
            (click)="onPageChange(currentPage() + 1)"
          >
            Sau
          </button>
        </div>
      }
    }
  }
</div>
