<header class="header" [class.scrolled]="isScrolled()">
  <div class="header-container">
    <div class="header-left">
      <a routerLink="/" class="logo">
        <span class="logo-mmo">MMO</span>
        <span class="logo-tool">Tool</span>
      </a>
      
      <nav class="nav-menu">
        @for (item of menuItems; track item.label) {
          <div class="nav-item-wrapper">
            @if (item.hasDropdown && item.dropdownItems) {
              <div class="nav-link-with-dropdown">
                @if (item.route) {
                  <a 
                    [routerLink]="item.route"
                    class="nav-link nav-link-with-route"
                    (click)="handleNavLinkClick($event, item.label)"
                  >
                    {{ item.label }}
                  </a>
                } @else {
                  <button 
                    class="nav-link nav-link-button"
                    (click)="toggleDropdown(item.label)"
                    [class.active]="isDropdownOpen(item.label)"
                  >
                    {{ item.label }}
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                }
                @if (item.route) {
                  <button 
                    class="nav-link-dropdown-toggle"
                    (click)="handleDropdownToggle($event, item.label)"
                    [class.active]="isDropdownOpen(item.label)"
                    type="button"
                  >
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                }
              </div>
              @if (isDropdownOpen(item.label)) {
                <div class="dropdown-menu">
                  @for (dropdownItem of item.dropdownItems; track dropdownItem.label) {
                    <a 
                      [routerLink]="dropdownItem.route" 
                      class="dropdown-item"
                      (click)="closeDropdown()"
                    >
                      {{ dropdownItem.label }}
                    </a>
                  }
                </div>
              }
            } @else {
              <a href="#" class="nav-link">
                {{ item.label }}
              </a>
            }
          </div>
        }
      </nav>
    </div>
    
    <div class="header-right">
      @if (isAuthenticated()) {
        <!-- Notification Bell -->
        <button class="icon-button notification-button" aria-label="Notifications">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 8A6 6 0 0 0 6 8C6 5.31371 8.68629 3 12 3C15.3137 3 18 5.31371 18 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <!-- Shopping Cart -->
        <button class="cart-button" aria-label="Shopping cart" (click)="navigateToCart()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19C19.4693 16.009 19.9268 15.8526 20.2925 15.5583C20.6581 15.264 20.9086 14.8504 21 14.39L22.6 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          @if (cartCount() > 0) {
            <span class="cart-badge">{{ cartCount() }}</span>
          }
        </button>

        <div class="header-separator"></div>

        <!-- Balance -->
        <div class="balance-display">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="coin-icon">
            <circle cx="12" cy="12" r="10" fill="#FFD700" stroke="#FFA500" stroke-width="2"/>
            <path d="M12 6V18M8 10H16M8 14H16" stroke="#FF8C00" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <span class="balance-amount">{{ formatBalance(balance()?.availableBalance || balance()?.balance) }}₫</span>
        </div>

        <div class="header-separator"></div>

        <!-- Profile Dropdown -->
        <div class="profile-dropdown-wrapper">
          <button class="profile-button" (click)="toggleProfileDropdown()">
            <span class="profile-name">{{ currentUser()?.username || currentUser()?.fullName || 'User' }}</span>
            <div class="profile-avatar">
              @if (currentUser()?.email) {
                <span class="avatar-initial">{{ (currentUser()?.username || currentUser()?.fullName || 'U')[0].toUpperCase() }}</span>
              }
            </div>
          </button>

          @if (showProfileDropdown()) {
            <div class="profile-dropdown">
              <!-- Profile Header -->
              <div class="profile-header">
                <div class="profile-avatar-large">
                  <span class="avatar-initial-large">{{ (currentUser()?.username || currentUser()?.fullName || 'U')[0].toUpperCase() }}</span>
                </div>
                <div class="profile-info">
                  <div class="profile-name-large">{{ currentUser()?.username || currentUser()?.fullName || 'User' }}</div>
                  <div class="profile-email">{{ currentUser()?.email || '' }}</div>
                </div>
              </div>

              <!-- Shop Management Button (if seller) -->
              @if (isSeller()) {
                <button class="shop-management-btn" (click)="navigateToShopManagement()">
                  Quản Lý Cửa Hàng
                </button>
                <div class="dropdown-divider"></div>
              }

              <!-- Menu Items -->
              <button class="profile-menu-item" (click)="navigateToAccountInfo()">
                Thông tin tài khoản
              </button>
              <button class="profile-menu-item" (click)="navigateToOrders()">
                Đơn hàng đã mua
              </button>
              <button class="profile-menu-item" (click)="navigateToPaymentHistory()">
                Lịch sử thanh toán
              </button>
              <button class="profile-menu-item" (click)="navigateToChangePassword()">
                Đổi mật khẩu
              </button>

              <div class="dropdown-divider"></div>

              <!-- Logout -->
              <button class="profile-menu-item logout-item" (click)="onLogout()">
                <span>Đăng xuất</span>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          }
        </div>
      } @else {
        <a routerLink="/register" class="btn-register">Đăng Ký</a>
        <a routerLink="/login" class="btn-login">Đăng Nhập</a>
      }
    </div>
  </div>
</header>
